<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>VR Physics Playground with Gun System</title>
    <meta name="description" content="VR Playground with Physics and Gun Mechanics">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #hud {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 20px;
            text-align: center;
            z-index: 1000;
            background: rgba(0,0,0,0.8);
            padding: 15px 30px;
            border-radius: 10px;
        }
        #ammo-display {
            font-size: 24px;
            color: #FFD700;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div id="hud">
        <div style="font-size: 28px; font-weight: bold; margin-bottom: 10px;">ðŸŽ® VR Physics Playground</div>
        <div id="ammo-display">Ammo: 12/12</div>
        <div style="font-size: 14px; margin-top: 10px; color: #AAA;">
            GRIP to grab | Push objects with hands | Shoot targets!
        </div>
    </div>

    <a-scene physics="gravity: -9.8; restitution: 0.5">
        <!-- Sky -->
        <a-sky color="#87CEEB"></a-sky>

        <!-- Ground with physics -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#7BC8A4" 
                 static-body shadow="receive: true"></a-plane>

        <!-- Lighting -->
        <a-light type="ambient" color="#666"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.8" position="-0.5 1 1" shadow="cast: true"></a-light>
        <a-light type="point" intensity="1" position="2 3 4"></a-light>

        <!-- Player Rig -->
        <a-entity id="player-rig" position="0 0 0" movement-controls="speed: 0.15; fly: false">
            <!-- Camera/Head -->
            <a-camera id="camera" position="0 1.6 0" look-controls>
                <a-text id="vr-prompt" value="" position="0 0.2 -0.6" align="center" color="#FFD700" width="0.5"></a-text>
                <a-text id="vr-ammo" value="12/12" position="0 -0.3 -0.5" align="center" color="#FFD700" width="0.5"></a-text>
            </a-camera>
            
            <!-- Player Body -->
            <a-entity id="player-body" position="0 0.9 0">
                <a-box id="torso" position="0 0 -0.15" width="0.5" height="0.7" depth="0.25" color="#2C3E50"></a-box>
                
                <!-- Ammo vest -->
                <a-entity id="ammo-vest" position="0 0 0.1">
                    <a-box class="ammo-pouch" position="-0.15 0.15 0" width="0.08" height="0.12" depth="0.04" color="#654321"></a-box>
                    <a-box class="ammo-pouch" position="-0.05 0.15 0" width="0.08" height="0.12" depth="0.04" color="#654321"></a-box>
                    <a-box class="ammo-pouch" position="0.05 0.15 0" width="0.08" height="0.12" depth="0.04" color="#654321"></a-box>
                    <a-box class="ammo-pouch" position="0.15 0.15 0" width="0.08" height="0.12" depth="0.04" color="#654321"></a-box>
                    
                    <!-- Magazines on chest -->
                    <a-entity id="magazine1" class="grabbable magazine" position="-0.1 0.25 0" magazine-controller grabbable proximity-prompt>
                        <a-box width="0.035" height="0.11" depth="0.06" color="#FFA500"></a-box>
                    </a-entity>
                    <a-entity id="magazine2" class="grabbable magazine" position="0.1 0.25 0" magazine-controller grabbable proximity-prompt>
                        <a-box width="0.035" height="0.11" depth="0.06" color="#FFA500"></a-box>
                    </a-entity>
                </a-entity>
            </a-entity>

            <!-- LEFT HAND with physics collider -->
            <a-entity 
                id="leftHand" 
                hand-controls="hand: left; handModelStyle: lowPoly"
                oculus-touch-controls="hand: left"
                vive-controls="hand: left"
                hand-grab-controller="hand: left"
                sphere-collider="radius: 0.08"
                kinematic-body>
            </a-entity>
            
            <!-- RIGHT HAND with physics collider -->
            <a-entity 
                id="rightHand" 
                hand-controls="hand: right; handModelStyle: lowPoly"
                oculus-touch-controls="hand: right"
                vive-controls="hand: right"
                hand-grab-controller="hand: right"
                sphere-collider="radius: 0.08"
                kinematic-body>
            </a-entity>
        </a-entity>

        <!-- TABLE 1: BLOCKS TABLE (Left) -->
        <a-box position="-2.5 0.95 -2" width="1.2" height="0.1" depth="0.8" color="#8B4513" static-body></a-box>
        <!-- Table legs -->
        <a-box position="-3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-2 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-2 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        
        <!-- Cubes on table 1 with physics -->
        <a-box class="grabbable" position="-2.7 1.1 -2" width="0.15" height="0.15" depth="0.15" color="#FF0000" 
               grabbable proximity-prompt dynamic-body="mass: 1" shadow="cast: true"></a-box>
        <a-box class="grabbable" position="-2.5 1.1 -2" width="0.15" height="0.15" depth="0.15" color="#00FF00" 
               grabbable proximity-prompt dynamic-body="mass: 1" shadow="cast: true"></a-box>
        <a-box class="grabbable" position="-2.3 1.1 -2" width="0.15" height="0.15" depth="0.15" color="#0000FF" 
               grabbable proximity-prompt dynamic-body="mass: 1" shadow="cast: true"></a-box>

        <!-- TABLE 2: SPHERES TABLE (Center-Left) -->
        <a-box position="-0.8 0.95 -2" width="1.2" height="0.1" depth="0.8" color="#A0522D" static-body></a-box>
        <a-box position="-1.3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-0.3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-1.3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="-0.3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        
        <!-- Spheres on table 2 with physics -->
        <a-sphere class="grabbable" position="-1 1.15 -2.1" radius="0.1" color="#FF00FF" 
                  grabbable proximity-prompt dynamic-body="mass: 0.5; shape: sphere" shadow="cast: true"></a-sphere>
        <a-sphere class="grabbable" position="-0.8 1.15 -2.1" radius="0.1" color="#FFA500" 
                  grabbable proximity-prompt dynamic-body="mass: 0.5; shape: sphere" shadow="cast: true"></a-sphere>
        <a-sphere class="grabbable" position="-0.6 1.15 -2.1" radius="0.1" color="#00FFFF" 
                  grabbable proximity-prompt dynamic-body="mass: 0.5; shape: sphere" shadow="cast: true"></a-sphere>

        <!-- TABLE 3: CYLINDERS TABLE (Center-Right) -->
        <a-box position="0.8 0.95 -2" width="1.2" height="0.1" depth="0.8" color="#D2691E" static-body></a-box>
        <a-box position="0.3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="1.3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="0.3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="1.3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        
        <!-- Cylinders on table 3 with physics -->
        <a-cylinder class="grabbable" position="0.5 1.15 -2" radius="0.06" height="0.2" color="#FFFF00" 
                    grabbable proximity-prompt dynamic-body="mass: 0.8; shape: cylinder" shadow="cast: true"></a-cylinder>
        <a-cylinder class="grabbable" position="0.8 1.15 -2" radius="0.06" height="0.2" color="#FF1493" 
                    grabbable proximity-prompt dynamic-body="mass: 0.8; shape: cylinder" shadow="cast: true"></a-cylinder>
        <a-cylinder class="grabbable" position="1.1 1.15 -2" radius="0.06" height="0.2" color="#00FF7F" 
                    grabbable proximity-prompt dynamic-body="mass: 0.8; shape: cylinder" shadow="cast: true"></a-cylinder>

        <!-- TABLE 4: GUN TABLE (Right) -->
        <a-box position="2.5 0.95 -2" width="1.2" height="0.1" depth="0.8" color="#654321" static-body></a-box>
        <a-box position="2 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="3 0.5 -2.3" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="2 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        <a-box position="3 0.5 -1.7" width="0.08" height="0.9" depth="0.08" color="#654321" static-body></a-box>
        
        <!-- Gun on table 4 -->
        <a-entity id="gun" class="grabbable" position="2.5 1.05 -2" grabbable proximity-prompt gun-controller>
            <a-box position="0 0 -0.1" width="0.08" height="0.12" depth="0.3" color="#1a1a1a"></a-box>
            <a-cylinder position="0 0.02 -0.28" rotation="90 0 0" radius="0.015" height="0.25" color="#333"></a-cylinder>
            <a-box position="0 -0.08 0.02" width="0.06" height="0.12" depth="0.08" color="#222"></a-box>
            <a-box id="mag-slot" position="0 -0.1 0" width="0.04" height="0.08" depth="0.06" color="#444" opacity="0.3"></a-box>
            <a-box position="0 0.07 -0.08" width="0.015" height="0.02" depth="0.03" color="#666"></a-box>
            <a-sphere id="muzzle-flash" position="0 0.02 -0.4" radius="0.05" color="#FFFF00" opacity="0" visible="false"></a-sphere>
        </a-entity>

        <!-- Target Wall -->
        <a-box position="0 2 -4" width="10" height="4" depth="0.1" color="#8B4513" static-body></a-box>
        <a-text value="SHOOT TARGETS!" position="0 3.5 -3.95" align="center" color="#FFF" width="6"></a-text>
        
        <!-- Shooting Targets -->
        <a-sphere class="target" data-points="10" position="-2 2 -3.95" radius="0.3" color="#FF0000" static-body></a-sphere>
        <a-sphere class="target" data-points="10" position="0 2 -3.95" radius="0.3" color="#FFFF00" static-body></a-sphere>
        <a-sphere class="target" data-points="10" position="2 2 -3.95" radius="0.3" color="#00FF00" static-body></a-sphere>
        <a-sphere class="target" data-points="20" position="-1 3 -3.95" radius="0.25" color="#0000FF" static-body></a-sphere>
        <a-sphere class="target" data-points="20" position="1 3 -3.95" radius="0.25" color="#FF00FF" static-body></a-sphere>

        <!-- Score Display -->
        <a-text id="scoreText" value="Score: 0" position="0 3 -3.9" align="center" color="#FFF" width="8"></a-text>

        <!-- Decorations -->
        <a-cylinder position="-4 0.5 -3" radius="0.3" height="1" color="#654321" static-body></a-cylinder>
        <a-cone position="-4 1.2 -3" radius-bottom="0.5" radius-top="0.05" height="0.8" color="#228B22" static-body></a-cone>
        
        <a-cylinder position="4 0.5 -3" radius="0.3" height="1" color="#654321" static-body></a-cylinder>
        <a-cone position="4 1.2 -3" radius-bottom="0.5" radius-top="0.05" height="0.8" color="#228B22" static-body></a-cone>
    </a-scene>

    <script>
        let score = 0;
        let currentAmmo = 12;
        let maxAmmo = 12;
        let gunHeld = false;

        // Sphere collider for hand physics
        AFRAME.registerComponent('sphere-collider', {
            schema: {
                radius: {type: 'number', default: 0.1}
            },
            init: function() {
                this.el.setAttribute('geometry', {
                    primitive: 'sphere',
                    radius: this.data.radius
                });
                this.el.setAttribute('visible', false); // Invisible collider
            }
        });

        // Grabbable component
        AFRAME.registerComponent('grabbable', {
            init: function() {
                this.grabbed = false;
                this.grabber = null;
                this.hadPhysics = false;
                this.velocity = new THREE.Vector3();
                this.previousPosition = new THREE.Vector3();
            }
        });

        // Magazine controller
        AFRAME.registerComponent('magazine-controller', {
            init: function() {
                this.el.classList.add('magazine');
            }
        });

        // Gun controller
        AFRAME.registerComponent('gun-controller', {
            init: function() {
                this.el.addEventListener('triggerdown', this.shoot.bind(this));
            },
            shoot: function(evt) {
                if (!gunHeld) return;
                if (currentAmmo <= 0) {
                    console.log('Out of ammo!');
                    return;
                }
                
                currentAmmo--;
                updateAmmoDisplay();
                
                // Muzzle flash
                const muzzleFlash = this.el.querySelector('#muzzle-flash');
                if (muzzleFlash) {
                    muzzleFlash.setAttribute('visible', 'true');
                    muzzleFlash.setAttribute('opacity', '0.8');
                    setTimeout(() => muzzleFlash.setAttribute('visible', 'false'), 50);
                }
                
                // Raycast to check hits
                const gunPos = this.el.object3D.getWorldPosition(new THREE.Vector3());
                const gunDir = new THREE.Vector3(0, 0, -1);
                gunDir.applyQuaternion(this.el.object3D.getWorldQuaternion(new THREE.Quaternion()));
                
                const raycaster = new THREE.Raycaster(gunPos, gunDir, 0, 20);
                const targets = document.querySelectorAll('.target');
                
                targets.forEach(target => {
                    const intersects = raycaster.intersectObject(target.object3D, true);
                    if (intersects.length > 0) {
                        shootTarget(target);
                    }
                });
            },
            checkReload: function(magazine) {
                const gunPos = this.el.object3D.getWorldPosition(new THREE.Vector3());
                const magPos = magazine.object3D.getWorldPosition(new THREE.Vector3());
                const distance = gunPos.distanceTo(magPos);
                
                if (distance < 0.2) {
                    currentAmmo = maxAmmo;
                    updateAmmoDisplay();
                    magazine.parentNode.removeChild(magazine);
                    spawnNewMagazine();
                    
                    const magSlot = this.el.querySelector('#mag-slot');
                    if (magSlot) {
                        magSlot.setAttribute('color', '#FFA500');
                        setTimeout(() => magSlot.setAttribute('color', '#444'), 200);
                    }
                    
                    console.log('Reloaded!');
                }
            }
        });

        // Proximity prompt
        AFRAME.registerComponent('proximity-prompt', {
            schema: {
                distance: {type: 'number', default: 0.3}
            },
            init: function() {
                this.checkProximity = this.checkProximity.bind(this);
            },
            tick: function() {
                this.checkProximity();
            },
            checkProximity: function() {
                if (this.el.components.grabbable.grabbed) return;
                
                const objPos = this.el.object3D.getWorldPosition(new THREE.Vector3());
                const leftHand = document.querySelector('#leftHand');
                const rightHand = document.querySelector('#rightHand');
                const vrPrompt = document.querySelector('#vr-prompt');
                
                let nearHand = false;
                
                if (leftHand) {
                    const leftPos = leftHand.object3D.getWorldPosition(new THREE.Vector3());
                    if (objPos.distanceTo(leftPos) < this.data.distance) nearHand = true;
                }
                
                if (rightHand) {
                    const rightPos = rightHand.object3D.getWorldPosition(new THREE.Vector3());
                    if (objPos.distanceTo(rightPos) < this.data.distance) nearHand = true;
                }
                
                if (nearHand) {
                    if (this.el.id === 'gun' && !gunHeld) {
                        if (vrPrompt) vrPrompt.setAttribute('value', 'GRIP: Equip Gun');
                    } else if (this.el.classList.contains('magazine')) {
                        if (vrPrompt) vrPrompt.setAttribute('value', 'GRIP: Grab Mag');
                    } else {
                        if (vrPrompt) vrPrompt.setAttribute('value', 'GRIP: Grab');
                    }
                    
                    const currentColor = this.el.getAttribute('color');
                    if (!this.el.hasAttribute('data-original-color')) {
                        this.el.setAttribute('data-original-color', currentColor);
                    }
                    this.el.setAttribute('material', 'emissive', currentColor);
                    this.el.setAttribute('material', 'emissiveIntensity', 0.3);
                } else {
                    this.el.setAttribute('material', 'emissiveIntensity', 0);
                }
            }
        });

        // Hand grab controller
        AFRAME.registerComponent('hand-grab-controller', {
            schema: {
                hand: {type: 'string', default: 'right'}
            },
            init: function() {
                this.grabbedObject = null;
                this.el.addEventListener('gripdown', this.grab.bind(this));
                this.el.addEventListener('gripup', this.release.bind(this));
            },
            grab: function() {
                const handPos = this.el.object3D.getWorldPosition(new THREE.Vector3());
                const grabbables = document.querySelectorAll('.grabbable');
                
                let closest = null;
                let closestDist = 0.3;
                
                grabbables.forEach(obj => {
                    if (obj.components.grabbable.grabbed) return;
                    
                    const objPos = obj.object3D.getWorldPosition(new THREE.Vector3());
                    const dist = handPos.distanceTo(objPos);
                    
                    if (dist < closestDist) {
                        closest = obj;
                        closestDist = dist;
                    }
                });
                
                if (closest) {
                    this.grabbedObject = closest;
                    closest.components.grabbable.grabbed = true;
                    
                    // Store if it had physics
                    if (closest.hasAttribute('dynamic-body')) {
                        closest.components.grabbable.hadPhysics = true;
                        closest.removeAttribute('dynamic-body');
                    }
                    
                    // Store world position for velocity calculation
                    const worldPos = new THREE.Vector3();
                    closest.object3D.getWorldPosition(worldPos);
                    closest.components.grabbable.previousPosition.copy(worldPos);
                    
                    // Attach to hand
                    this.el.appendChild(closest);
                    
                    // Position visible in front of hand
                    if (closest.id === 'gun') {
                        // Gun positioning
                        if (this.data.hand === 'right') {
                            closest.setAttribute('position', '0.05 -0.1 -0.25');
                            closest.setAttribute('rotation', '-15 0 0');
                        } else {
                            closest.setAttribute('position', '0.05 -0.1 -0.25');
                            closest.setAttribute('rotation', '-15 0 0');
                        }
                    } else if (closest.classList.contains('magazine')) {
                        // Magazine positioning
                        closest.setAttribute('position', '0 -0.05 -0.15');
                        closest.setAttribute('rotation', '0 0 0');
                    } else {
                        // Regular objects - position in front and below hand
                        closest.setAttribute('position', '0 -0.08 -0.2');
                        closest.setAttribute('rotation', '0 0 0');
                    }
                    
                    // Make sure it's scaled properly
                    closest.setAttribute('scale', '1 1 1');
                    
                    if (closest.id === 'gun') {
                        gunHeld = true;
                        console.log('Gun equipped!');
                    }
                    
                    // Remove highlight
                    closest.setAttribute('material', 'emissiveIntensity', 0);
                    
                    // Update prompt
                    const vrPrompt = document.querySelector('#vr-prompt');
                    if (vrPrompt) {
                        if (closest.id === 'gun') {
                            vrPrompt.setAttribute('value', 'Holding Gun - Trigger to Shoot');
                        } else if (closest.classList.contains('magazine')) {
                            vrPrompt.setAttribute('value', 'Holding Magazine');
                        } else {
                            vrPrompt.setAttribute('value', 'Holding Object');
                        }
                    }
                    
                    console.log(this.data.hand + ' hand grabbed:', closest.tagName, 'at position:', closest.getAttribute('position'));
                }
            },
            release: function() {
                if (!this.grabbedObject) return;
                
                const obj = this.grabbedObject;
                const scene = document.querySelector('a-scene');
                
                // Get current world position before detaching
                const worldPos = new THREE.Vector3();
                const worldQuat = new THREE.Quaternion();
                obj.object3D.getWorldPosition(worldPos);
                obj.object3D.getWorldQuaternion(worldQuat);
                
                // Calculate throw velocity
                const velocity = new THREE.Vector3().subVectors(
                    worldPos,
                    obj.components.grabbable.previousPosition
                );
                
                console.log('Releasing object at world position:', worldPos);
                
                // Detach from hand
                scene.appendChild(obj);
                
                // Set world position and rotation
                obj.object3D.position.copy(worldPos);
                obj.object3D.quaternion.copy(worldQuat);
                
                // Check for magazine reload
                if (obj.classList.contains('magazine') && gunHeld) {
                    const gun = document.querySelector('#gun');
                    if (gun && gun.components['gun-controller']) {
                        gun.components['gun-controller'].checkReload(obj);
                        obj.components.grabbable.grabbed = false;
                        this.grabbedObject = null;
                        return;
                    }
                }
                
                // Restore physics if object had it
                if (obj.components.grabbable.hadPhysics) {
                    let mass = 1;
                    let shape = 'box';
                    
                    if (obj.tagName === 'A-SPHERE') {
                        shape = 'sphere';
                        mass = 0.5;
                    } else if (obj.tagName === 'A-CYLINDER') {
                        shape = 'cylinder';
                        mass = 0.8;
                    }
                    
                    obj.setAttribute('dynamic-body', {
                        mass: mass,
                        shape: shape,
                        linearDamping: 0.1,
                        angularDamping: 0.1
                    });
                    
                    // Apply throw force after physics is added
                    setTimeout(() => {
                        const body = obj.body;
                        if (body) {
                            const throwStrength = 15;
                            
                            // Get hand forward direction
                            const handDir = new THREE.Vector3(0, 0, -1);
                            handDir.applyQuaternion(this.el.object3D.getWorldQuaternion(new THREE.Quaternion()));
                            
                            // Combine velocity with hand direction
                            const throwVel = velocity.multiplyScalar(throwStrength);
                            throwVel.add(handDir.multiplyScalar(2));
                            
                            // Apply to physics body
                            body.velocity.set(throwVel.x, throwVel.y, throwVel.z);
                            
                            // Add some spin
                            body.angularVelocity.set(
                                (Math.random() - 0.5) * 5,
                                (Math.random() - 0.5) * 5,
                                (Math.random() - 0.5) * 5
                            );
                            
                            console.log('Applied throw velocity:', throwVel);
                        }
                    }, 50);
                }
                
                if (obj.id === 'gun') {
                    gunHeld = false;
                    console.log('Gun released');
                }
                
                // Clear grabbed state
                obj.components.grabbable.grabbed = false;
                this.grabbedObject = null;
                
                // Clear prompt
                const vrPrompt = document.querySelector('#vr-prompt');
                if (vrPrompt) vrPrompt.setAttribute('value', '');
            },
            tick: function() {
                if (this.grabbedObject) {
                    const currentPos = this.grabbedObject.object3D.getWorldPosition(new THREE.Vector3());
                    this.grabbedObject.components.grabbable.previousPosition.copy(currentPos);
                }
            }
        });

        function shootTarget(target) {
            const points = parseInt(target.getAttribute('data-points')) || 10;
            score += points;
            updateScore();
            
            const originalColor = target.getAttribute('color');
            target.setAttribute('color', '#FFFFFF');
            
            target.setAttribute('animation__shoot', {
                property: 'scale',
                to: '0.1 0.1 0.1',
                dur: 150
            });
            
            setTimeout(() => {
                target.setAttribute('color', originalColor);
                target.setAttribute('animation__reset', {
                    property: 'scale',
                    to: '1 1 1',
                    dur: 150
                });
            }, 400);
        }

        function updateScore() {
            const scoreText = document.querySelector('#scoreText');
            if (scoreText) scoreText.setAttribute('value', `Score: ${score}`);
        }

        function updateAmmoDisplay() {
            const ammoStr = `${currentAmmo}/${maxAmmo}`;
            const ammoDisplay = document.querySelector('#ammo-display');
            const vrAmmo = document.querySelector('#vr-ammo');
            
            if (ammoDisplay) ammoDisplay.textContent = `Ammo: ${ammoStr}`;
            if (vrAmmo) {
                vrAmmo.setAttribute('value', ammoStr);
                if (currentAmmo <= 3) {
                    vrAmmo.setAttribute('color', '#FF0000');
                } else {
                    vrAmmo.setAttribute('color', '#FFD700');
                }
            }
        }

        function spawnNewMagazine() {
            const ammoVest = document.querySelector('#ammo-vest');
            if (!ammoVest) return;
            
            const magCount = document.querySelectorAll('.magazine').length;
            const xPos = (magCount % 2 === 0) ? -0.1 : 0.1;
            
            const newMag = document.createElement('a-entity');
            newMag.classList.add('grabbable', 'magazine');
            newMag.setAttribute('magazine-controller', '');
            newMag.setAttribute('grabbable', '');
            newMag.setAttribute('proximity-prompt', '');
            newMag.setAttribute('position', `${xPos} 0.25 0`);
            
            const box = document.createElement('a-box');
            box.setAttribute('width', '0.035');
            box.setAttribute('height', '0.11');
            box.setAttribute('depth', '0.06');
            box.setAttribute('color', '#FFA500');
            newMag.appendChild(box);
            
            ammoVest.appendChild(newMag);
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('VR Physics Playground loaded!');
            updateAmmoDisplay();
        });
    </script>
</body>
</html>
